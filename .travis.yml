language: ruby
sudo: required

services:
  - docker

jobs:
  include:
    - stage: build
      before_install:
        - cd sagemaker
        #- docker build -t niacainfosys/vision-api-gpu-base:1.2.0 -f vision-api-gpu-base.Dockerfile .
      script:
        - pip install --user awscli
        - export PATH=$PATH:$HOME/.local/bin # put aws in the path
        - eval $(aws ecr get-login --region us-east-1 --registry-ids 763104351884 --no-include-email )
        - docker pull 763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-inference:1.14.0-cpu
        - docker run 763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-inference:1.14.0-cpu /bin/bash -c "python --version; pip list; java -version; apt list --installed"
        #- docker run niacainfosys/vision-api-gpu-base:1.2.0 /bin/bash -c "python --version; pip list; java -version; apt list --installed"
        #- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        #- docker push niacainfosys/vision-api-gpu-base:1.2.0